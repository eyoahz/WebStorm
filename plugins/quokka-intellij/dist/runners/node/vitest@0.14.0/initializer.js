/*
 * Wallaby.js - v1.0.1427
 * https://wallabyjs.com
 * Copyright (c) 2014-2023 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
function normalizeModuleId(e){return e.replace(/\\/g,"/").replace(/^\/@fs\//,isWindows?"":"/").replace(/^file:\//,"/").replace(/^node:/,"").replace(/^\/+/,"/")}function getFileData(e){e.indexOf("?wallaby=")!==-1&&(e=e.substr(0,e.indexOf("?wallaby=")));var t=utils.normalizePath(utils.normalizePath(e).replace(globalContext.normalizedLocalProjectDir,"").replace(globalContext.normalizedProjectCacheDir,""));"/"===t[0]&&(t=t.substr(1));var i=tracer._filePathToFileData[t];return!i&&globalContext.normalizedRootPrefix&&(i=tracer._filePathToFileData[globalContext.normalizedRootPrefix+t]),i}function wrapFetchedModule(e,t){if(e=normalizeModuleId(e),testRunContext.fetchedModules.has(e))return testRunContext.fetchedModules.get(e);var i=getFileData(e);if(!i||!i.instrument)return t;if(!testRunContext.instrumentedFiles.has(i.id))return t;var r=testRunContext.instrumentedFiles.get(i.id);delete t.map,tracer.sendTransformedFile(r),r.instrumented.numberOfFunctions!==i.numberOfFunctions&&delete r.instrumented.testName;var n,s={id:i.id,ranges:r.instrumented.ranges.length};if(i.test&&(!global.$_$traceContext||!global.$_$traceContext.test))if(n={name:i.allowedToRunSingleTestOnly&&r.instrumented.testName},n.name){"*"===global.$_$tests&&(global.$_$tests={});var o=global.$_$tests[":?"]=global.$_$tests[":?"]||{};o[":"+n.name]="*"}else global.$_$tests&&global.$_$tests[":?"]&&(global.$_$tests="*");return t=__assign(__assign({},t),{coverage:s,filter:n}),testRunContext.fetchedModules.set(e,t),t}function initializeVitest(){return __awaiter(this,void 0,void 0,function(){var vitestPackage,vitestDist,viteNodePackage,viteNodeDist,vitestRunnerPackage,vitestRunnerDist,createVitestFileToPatchFileName,transformRequestIdFileName,esmHooks,dependency,_a,root;return __generator(this,function(_b){switch(_b.label){case 0:if(globalContext.ctx)return[3,4];if(vitestPackage=utils.tryRequireModuleWithPathFrom(globalContext.localProjectRoot,"vitest/package.json",!1),!vitestPackage)throw new Error("Vitest dependency not found.");if(vitestDist=path.join(path.dirname(vitestPackage.path),"dist"),viteNodePackage=utils.tryRequireModuleWithPathFrom(path.dirname(vitestPackage.path),"vite-node",!1),viteNodeDist=viteNodePackage?path.dirname(viteNodePackage.path):vitestDist,vitestRunnerPackage=utils.tryRequireModuleWithPathFrom(globalContext.localProjectRoot,"@vitest/runner/package.json",!1),vitestRunnerDist=vitestRunnerPackage?path.join(path.dirname(vitestRunnerPackage.path),"dist"):vitestDist,createVitestFileToPatchFileName=utils.findFirstFileMatchingContentInDirectory(vitestDist,"const ctx = await createVitest(options, viteOverrides);")||utils.findFirstFileMatchingContentInDirectory(vitestDist,"const ctx = await createVitest(mode, options, viteOverrides);"),!createVitestFileToPatchFileName)throw new Error("Could not find vitest entry point.");if(transformRequestIdFileName=utils.findFirstFileMatchingContentInDirectory(viteNodeDist,"async _transformRequest(id, filepath, customTransformMode) {")||utils.findFirstFileMatchingContentInDirectory(viteNodeDist,"async _transformRequest(id, customTransformMode) {")||utils.findFirstFileMatchingContentInDirectory(viteNodeDist,"async _transformRequest(id) {")||createVitestFileToPatchFileName,globalContext.vitestDistLoader=path.join(path.dirname(vitestPackage.path),"dist","loader.js"),globalContext.viteNodeUtils=utils.findFirstFileMatchingContentInDirectory(viteNodeDist,"{ code: transformed, externalize } = await this.options.fetchModule("),!globalContext.viteNodeUtils&&(globalContext.viteNodeUtils=utils.findFirstFileMatchingContentInDirectory(vitestDist,"{ code: transformed, externalize } = await this.options.fetchModule("),!globalContext.viteNodeUtils))throw new Error("Could not find vitest utils");if(globalContext.vendorEntryFilePath=utils.findFirstFileMatchingContentInDirectory(vitestRunnerDist,"function updateTask(task"),!globalContext.vendorEntryFilePath)throw new Error("Could not find vendor entry.");if(globalContext.entryFilePath=utils.findFirstFileMatchingContentInDirectory(vitestDist,"function setupGlobalEnv(config)"),globalContext.runtimeChainPath=utils.findFirstFileMatchingContentInDirectory(vitestDist,"// Vitest Snapshot v"),!globalContext.runtimeChainPath)throw new Error("Could not find runtime chain file.");return globalContext.esmHooksPath=path.join(path.dirname(process.mainModule.filename),"runners/node/hooks.mjs"),[4,eval("import('"+url.pathToFileURL(globalContext.esmHooksPath)+"')")];case 1:return esmHooks=_b.sent(),esmHooks.patchFile(transformRequestIdFileName,[{key:"transformRequest",from:"async _transformRequest(id) {",to:"async _transformRequest(id) { return global.$_$wallabyVitest.transformRequest(id, undefined, undefined, await this._wallabyTransformRequest(id)); } async _wallabyTransformRequest(id) { id = global.$_$wallabyVitest.adjustTransformRequestId(id);"},{key:"transformRequest",from:"async _transformRequest(id, customTransformMode) {",to:"async _transformRequest(id, customTransformMode) { return global.$_$wallabyVitest.transformRequest(id, undefined, customTransformMode, await this._wallabyTransformRequest(id, customTransformMode)); } async _wallabyTransformRequest(id, customTransformMode) { id = global.$_$wallabyVitest.adjustTransformRequestId(id);"},{key:"transformRequest",from:"async _transformRequest(id, filepath, customTransformMode) {",to:"async _transformRequest(id, filepath, customTransformMode) { return global.$_$wallabyVitest.transformRequest(id, filepath, customTransformMode, await this._wallabyTransformRequest(id, filepath, customTransformMode)); } async _wallabyTransformRequest(id, filepath, customTransformMode) { id = global.$_$wallabyVitest.adjustTransformRequestId(id);"},{key:"mockProcessing",from:'if (sourcemap === "inline" && result ',to:'if (result && result._wallabyProcessed) { return result; } if (sourcemap === "inline" && result '}]),esmHooks.patchFile(createVitestFileToPatchFileName,[{key:"createVitest",from:"const ctx = await createVitest(options, viteOverrides);",to:"const ctx = await createVitest(options, viteOverrides); global.$_$wallabyVitest.adjustCtxAfterCreateVitest(ctx);"},{key:"createVitest",from:"const ctx = await createVitest(mode, options, viteOverrides);",to:"const ctx = await createVitest(mode, options, viteOverrides); global.$_$wallabyVitest.adjustCtxAfterCreateVitest(ctx);"},{key:"startVitest",from:"async function startVitest(cliFilters, options, viteOverrides) {",to:"export async function startVitest(cliFilters, options, viteOverrides) {"},{key:"startVitest",from:"async function startVitest(mode, cliFilters, options, viteOverrides) {",to:"export async function startVitest(cliFilters, options, viteOverrides) { let mode = 'test';"},{key:"startVitest",from:"async function startVitest(mode, cliFilters = [], options = {}, viteOverrides) {",to:"export async function startVitest(cliFilters = [], options = {}, viteOverrides) { let mode = 'test';"},{key:"onWallabyWorkerMessage",from:"onWorkerExit(code) {",to:"async onWallabyWorkerMessage(message) { await global.$_$wallabyVitest.wallabyWorkerMessage(message); }, onWorkerExit(code) {"},{key:"onWallabyWorkerMessage",from:"async onWorkerExit(error, code) {",to:"async onWallabyWorkerMessage(message) { await global.$_$wallabyVitest.wallabyWorkerMessage(message); }, async onWorkerExit(error, code) {"},{key:"fetchModule",from:"return ctx.vitenode.fetchModule(id);",to:"return global.$_$wallabyVitest.fetchModule(id, undefined, ctx);"},{key:"fetchModule",from:"return ctx.vitenode.fetchModule(id, transformMode);",to:"return global.$_$wallabyVitest.fetchModule(id, transformMode, ctx);"},{key:"fetchModule",from:"return project.vitenode.fetchModule(id, transformMode);",to:"return global.$_$wallabyVitest.fetchModule(id, transformMode, project);"},{key:"GlobalSetupPlugin",from:"GlobalSetupPlugin(ctx),",to:"GlobalSetupPlugin(ctx), [...global.$_$wallabyVitest.viteTestPluginAdjustments()],"},{key:"GlobalSetupPlugin",from:"GlobalSetupPlugin(ctx, ctx.logger),",to:"GlobalSetupPlugin(ctx, ctx.logger), [...global.$_$wallabyVitest.viteTestPluginAdjustments()],"},{key:"GlobalSetupPlugin",from:"GlobalSetupPlugin(project, project.ctx.logger),",to:"GlobalSetupPlugin(project, project.ctx.logger), [...global.$_$wallabyVitest.viteTestPluginAdjustments()],"},{key:"report",from:'ctx.report("onCollected", files);',to:'ctx.report("onCollected", files, sessionId);'},{key:"report",from:'project.report("onCollected", files);',to:'project.report("onCollected", files, sessionId);'},{key:"globalSetupFiles",from:"globalSetupFiles = await loadGlobalSetupFiles(ctx);",to:"globalSetupFiles = await global.$_$wallabyVitest.loadGlobalSetupFiles(async () => await loadGlobalSetupFiles(ctx));"},{key:"globalSetupFiles",from:"globalSetupFiles = await loadGlobalSetupFiles(project);",to:"globalSetupFiles = await global.$_$wallabyVitest.loadGlobalSetupFiles(async () => await loadGlobalSetupFiles(project));"},{from:"async start(filters) {",to:"async start(filters) { return;"},{from:"await ctx.start(cliFilters);",to:"await ctx.start(cliFilters); return ctx;"},{from:"async report(name, ...args) {",to:"async report(name, ...args) { global.$_$wallabyVitest.report(name, ...args); return;"},{from:"filename: workerPath,",to:"filename: global.$_$wallabyVitest.adjustedWorkerEntryPoint(),"},{from:"const pool = new Tinypool(options);",to:"const pool = global.$_$wallabyVitest.wrapTinyPoolResult(new Tinypool(global.$_$wallabyVitest.tinyPoolOptions(options)));"},{from:"await pool.run(data, { transferList: [workerPort], name });",to:"global.$_$wallabyVitest.runResult(await pool.run({ workerPath, ...data, ...global.$_$wallabyVitest.generateWorkerContext() }, { transferList: [workerPort], name, signal: global.$_$wallabyVitest.abortSignal() }));"},{from:"onCollected(files) {",to:"onCollected(files, sessionId) {"}]),[4,eval("import('"+url.pathToFileURL(createVitestFileToPatchFileName)+"')")];case 2:if(dependency=_b.sent(),globalContext.initializationFailed)throw new Error(globalContext.initializationFailed);return _a=globalContext,[4,dependency.startVitest([],{},{})];case 3:_a.ctx=_b.sent(),root=globalContext.ctx.config.root+(globalContext.ctx.config.root.endsWith("/")?"":"/"),root.startsWith(globalContext.normalizedLocalProjectDir)&&(globalContext.normalizedRootPrefix=root.substring(globalContext.normalizedLocalProjectDir.length+1)),_b.label=4;case 4:if(globalContext.initializationFailed)throw new Error(globalContext.initializationFailed);return[2]}})})}var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,i,r){function n(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r["throw"](e))}catch(t){s(t)}}function l(e){e.done?i(e.value):n(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,s&&(o=2&i[0]?s["return"]:i[0]?s["throw"]||((o=s["return"])&&o.call(s),0):s.next)&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,s=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(r){i=[6,r],s=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,s,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=this&&this.__read||function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,s=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){n={error:a}}finally{try{r&&!r.done&&(i=s["return"])&&i.call(s)}finally{if(n)throw n.error}}return o},__spreadArray=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var r,n=0,s=t.length;n<s;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},path=require("path"),url=require("url"),fs=require("fs"),tracer=global.$_$tracer,_=global._,utils=tracer._utils,testRunContext,globalContext={entryFilePath:void 0,vendorEntryFilePath:void 0,esmHooksPath:void 0,runtimeChainPath:void 0,viteNodeUtils:void 0,vitestDistLoader:void 0,ctx:void 0,initializationFailedMessage:"",localProjectRoot:path.dirname(global.wallaby._localNodeModules),originalCacheRoot:global.wallaby._originalCacheRoot,normalizedLocalProjectDir:utils.normalizePath(path.dirname(global.wallaby._localNodeModules)),normalizedProjectCacheDir:utils.normalizePath(global.wallaby._originalCacheRoot),normalizedRootPrefix:void 0,tinyPool:void 0,abortSignal:void 0,globalSetup:!1,previousTimeStamps:{},runningPromise:Promise.resolve()};utils.patchModule("@rollup/pluginutils",function(e){var t=e("@rollup/pluginutils"),i=t.createFilter;return t.createFilter=function(){var e=i.apply(this,arguments);return function(t){return"string"==typeof t&&(t=t.split("?wallaby=")[0]),e(t)}},t}),utils.patchModulesCode([{files:["vite-plugin-solid/dist/cjs/index.cjs"],replacements:[{from:"function getExtension(filename) {",to:"function getExtension(filename) { filename = filename && filename.split('?')[0];"},{from:"async transform(source, id, transformOptions) {",to:"async transform(source, id, transformOptions) { id = id && id.split('?')[0];"}]},{files:["vite-plugin-html/dist/index.mjs"],replacements:[{from:"consola.wrapConsole();",to:""}]},{files:["vite-plugin-html/dist/index.cjs"],replacements:[{from:"consola__default.wrapConsole();",to:""}]}]),utils.patchModulesCode([{files:["vite-plugin-vue-type-imports/dist/index.js"],replacements:[{from:"if(!/\\.(vue)$/.test(p))",to:"if(!/\\.(vue)$/.test(p.split('?')[0]))"}]}],"Possibly unsupported version of 'vite-plugin-vue-type-imports'");var isWindows="win32"===process.platform,wallabyWorkerMessageProcessors={receiverMessage:function(e){tracer._receiver.send(e)},receiverHighPriorityMessage:function(e){tracer._highPriorityReceiver.send(e)},uncaughtException:function(e){tracer.reportGlobalError(e)},profile:function(e){global.$_$tracer._profileResult=e},inlineSnapshotSaved:function(e){var t=getFileData(e.fileName);if(t){var i=t.inOriginalFilesCache?path.join(globalContext.originalCacheRoot,t.path):e.fileName,r=fs.readFileSync(i).toString(),n=e.content;tracer.sendFileChange({id:t.id,oldContent:r,newContent:n})}},log:function(e){console.log(e)},debugLog:function(e){tracer.debugLog(e)}};global.$_$wallabyVitest={fetchModule:function(e,t,i){return new Promise(function(r,n){i.vitenode.fetchModule(e,t).then(function(t){r(wrapFetchedModule(e,t))})["catch"](function(e){n(e)})})},adjustCtxAfterCreateVitest:function(e){e.config.sourcemap="inline",e.config.coverage.enabled=!1,e.config.watch=!1},report:function(e,t,i){var r,n;if("onCollected"===e){if(i&&i!==global.$_$session)return;try{for(var s=__values(t),o=s.next();!o.done;o=s.next()){var a=o.value;a.result&&"fail"===a.result.state&&tracer.reportGlobalError(a.result.error)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=s["return"])&&n.call(s)}finally{if(r)throw r.error}}}},WallabyVitePrePlugin:function(){return{name:"vitest:wallaby-preprocessing",load:function(e){var t=getFileData(e);if(t&&t.instrument&&t.inOriginalFilesCache)return fs.readFileSync(path.join(globalContext.originalCacheRoot,t.path),"utf8")}}},WallabyVitePostPlugin:function(){return{name:"vitest:wallaby-postprocessing",enforce:"post",transform:function(e,t){var i;if(t===globalContext.vendorEntryFilePath?i=[{from:"const hasOnlyTasks",to:"global.$_$wallabyVitest.adjustFileTasks(file); const hasOnlyTasks"},{key:"updateTask",from:"function updateTask(task) {",to:"function updateTask(task) { global.$_$wallabyVitest.updateTask(task); "},{key:"updateTask",from:"function updateTask(task, runner) {",to:"function updateTask(task, runner) { global.$_$wallabyVitest.updateTask(task); "},{key:"getFn",from:"await getFn(test)();",to:"global.$_$wallabyVitest.getFn(test); await getFn(test)();"},{key:"getFn",from:"const fn = getFn(test);",to:"global.$_$wallabyVitest.getFn(test); const fn = getFn(test);"},{key:"runSuite",from:"await runSuite(file);",to:"global.$_$wallabyVitest.runSuite(file); await runSuite(file);"},{key:"runSuite",from:"await runSuite(file, runner);",to:"global.$_$wallabyVitest.runSuite(file); await runSuite(file, runner);"},{key:"collected",from:"rpc().onCollected(files);",to:"rpc().onCollected(files, global.$_$session);"},{key:"collected",from:"rpc().onCollected(files);",to:"rpc().onCollected(files, global.$_$session);"},{key:"collected",from:"(_b = runner.onCollected) == null ? void 0 : _b.call(runner, files);",to:"(_b = runner.onCollected) == null ? void 0 : _b.call(runner, files, global.$_$session);"}]:t===globalContext.runtimeChainPath&&(i=[{from:'await promises.writeFile(file, transformed, "utf-8");',to:"global.$_$wallabyVitest.inlineSnapshotSaved(file, transformed)"},{from:'if (hasSnapshot && this._updateSnapshot === "all" || ',to:'global.$_$tracer._matchSnapshot({ key, snapshotPath: this.snapshotPath }); if (hasSnapshot && this._updateSnapshot === "all" || '},{from:"this._updateSnapshot = options.updateSnapshot;",to:"this._updateSnapshot = global.$_$wallabyVitest.updateSnapshot();"},{from:'if (this._updateSnapshot === "all" && this._uncheckedKeys.size) {',to:'if ((global.$_$wallabyVitest.canUpdateSnapshot(this)) && this._updateSnapshot === "all" && this._uncheckedKeys.size) {'},{from:'if (hasSnapshot && this._updateSnapshot === "all" || (!hasSnapshot || !snapshotIsPersisted) && (this._updateSnapshot === "new" || this._updateSnapshot === "all")) {',to:'if ((global.$_$wallabyVitest.canUpdateSnapshot(this)) && ((hasSnapshot && this._updateSnapshot === "all" || (!hasSnapshot || !snapshotIsPersisted) && (this._updateSnapshot === "new" || this._updateSnapshot === "all")))) {'},{from:"this.snapshotState = this.getSnapshotState(test);",to:"this.snapshotState = this.getSnapshotState(test); global.$_$wallabyVitest.getSnapshotState(this);"},{from:"if (!isRunningInBenchmark())",to:"if (!isRunningInBenchmark()) return;",optional:!0}]),i){var r=[];if(i.forEach(function(t,n){if(r&&e.indexOf(t.from)===-1&&!t.optional)if(t.key){var s=i.find(function(i,r){return r!==n&&i.key===t.key&&e.indexOf(i.from)!==-1});s||r.push(n)}else r.push(n)}),r.length)throw new Error("Transform ("+t+"): Wallaby is not compatible with current version of Vitest ["+r.reduce(function(e,t){return e+(e.length?", "+t:t)},"")+"].");return i.reduce(function(e,t){return e.replace(t.from,t.to)},e)}return{code:e}}}},viteTestPluginAdjustments:function(){return[this.WallabyVitePrePlugin(),this.WallabyVitePostPlugin()]},adjustedWorkerEntryPoint:function(){return utils.normalizePath(path.resolve(__dirname,"worker.mjs"))},runResult:function(e){e.error&&tracer.reportGlobalError("Error executing tests in vitest:\n"+(e.error.message||"")+"\n"+(e.error.stack||""))},generateWorkerContext:function(){var e=__assign(__assign({},wallaby),{localProjectRoot:globalContext.localProjectRoot});delete e.delayStart,delete e.start,delete e._startWhenReceiverIsReady,delete e.testFramework;var t=testRunContext.childSessionId++;return{wallabyContext:{entryFilePath:globalContext.entryFilePath,esmHooksPath:globalContext.esmHooksPath,viteNodeUtils:globalContext.viteNodeUtils,vitestDistLoader:globalContext.vitestDistLoader,vendorEntryFilePath:globalContext.vendorEntryFilePath,runtimeChainPath:globalContext.runtimeChainPath,normalizedRootPrefix:globalContext.normalizedRootPrefix,globals:{$_$coverage:$_$coverage,$_$logsSuppressions:$_$logsSuppressions,$_$baseDir:$_$baseDir,$_$slow:$_$slow,$_$tests:$_$tests,$_$testFiles:$_$testFiles,$_$session:$_$session,$_$initialSpecId:1e5*t,$_$traceContext:$_$traceContext,$_$profileRun:$_$profileRun,$_$resolveGetters:$_$resolveGetters,$_$logLimits:$_$logLimits,wallaby:e,$_$childSession:t},tracer:{_filePathToFileData:global.$_$tracer._filePathToFileData,_hints:global.$_$tracer._hints,_autoConsoleLog:global.$_$tracer._autoConsoleLog,_captureConsoleLog:global.$_$tracer._captureConsoleLog,_preserveComments:global.$_$tracer._preserveComments,_reportConsoleErrorAsError:global.$_$tracer._reportConsoleErrorAsError,_suppressCallStackEval:global.$_$tracer._suppressCallStackEval,_updateNoMoreThanOneSnapshotPerTestFileRun:global.$_$tracer._updateNoMoreThanOneSnapshotPerTestFileRun,_shouldReportProgramScope:global.$_$tracer._shouldReportProgramScope,_maxLogEntrySize:global.$_$tracer._maxLogEntrySize,_maxTraceSteps:global.$_$tracer._maxTraceSteps,_manualTestRun:global.$_$tracer._manualTestRun,_updateSnapshotsRun:global.$_$tracer._updateSnapshotsRun,_expressionsToEvaluate:global.$_$tracer._expressionsToEvaluate}}}},transformRequest:function(e,t,i,r){var n=getFileData(e);if(!n||!n.instrument||globalContext.globalSetup||r._wallabyProcessed)return r;var s=_.extend({},global.$_$tracer._hints);n.test&&(s.allowIgnoringCoverageInTests||(s=_.omit(s,"ignoreCoverage","ignoreCoverageForFile"))),s=_.omit(s,"testFileSelection"),r.map&&r.map.sources&&(r.map.sources=r.map.sources.map(function(e){return e?e:n.path}));var o;r.map&&(n.changeStart||n.logMarkers&&n.logMarkers.length||n.extractedComments&&!n.extractedComments.isCoverageIgnored||n.test)&&(o=new utils.SourceMapConsumer(r.map));var a,l=utils.mapTextPosition(n.changeStart&&n.changePosition,o),c=n.logMarkers||[];try{a=utils.instrument(r.code,{file:n.id,test:n.test,fileName:path.basename(n.path),testFileChangeStart:l,hints:s,recordValues:global.$_$tracer._autoConsoleLog,captureConsoleLog:global.$_$tracer._captureConsoleLog,recordMatchSnapshotRanges:!0,preserveComments:global.$_$tracer._preserveComments,logMarkers:c.map(function(e){return{originalRange:e.range,range:utils.mapOriginalRangeToTransformed(o,e.range),changeId:e.id,traceId:e.traceId,expanded:e.expanded,"new":e["new"],exp:e.exp,action:e.action}}),extractedComments:utils.remapComments(n.extractedComments,r.code,o)})}catch(u){throw utils.formatInstrumentationError(u,code,n.path)}return a.liveCommentLines&&r.map?(o||(o=new utils.SourceMapConsumer(r.map)),a.liveCommentLines=_.chain(a.liveCommentLines).map(function(e,t){return{line:parseInt(t,10),column:e+1}}).map(function(e){var t=e.line,i=e.column;return utils.mapTransformedRangeToOriginal(o,[t,i,t,i])}).filter(function(e){return e&&e.length}).map(function(e){return e[0]}).value()):a.liveCommentLines&&(a.liveCommentLines=Object.keys(a.liveCommentLines).map(function(e){return parseInt(e,10)}).filter(function(e){return e}).map(function(e){return e})),testRunContext.instrumentedFiles.set(n.id,{id:n.id,parentFilePath:void 0,transformed:_.omit(r,"code"),instrumented:_.omit(a,"code","map"),ts:n.ts,originalTs:n.originalTs,runnerCacheKey:n.runnerCacheKey,matchSnapshotRanges:a.matchSnapshotRanges&&a.matchSnapshotRanges.length&&o?a.matchSnapshotRanges.map(function(e){return utils.mapTransformedRangeToOriginal(o,e)}):void 0,transformedTime:(new Date).toISOString(),lineMap:utils.updateFileMap({},r.map?[r.map,a.map]:[a.map])}),r.code=a.code,r.map=a.map,r._wallabyProcessed=!0,r},adjustTransformRequestId:function(e){e=normalizeModuleId(e);var t=getFileData(e);return t&&t.instrument?e+"?wallaby="+t.ts+(globalContext.globalSetup?"G":""):e},wallabyWorkerMessage:function(e){e&&e.sessionId&&e.sessionId!==global.$_$session||wallabyWorkerMessageProcessors[e.type]&&wallabyWorkerMessageProcessors[e.type](e.payload)},tinyPoolOptions:function(e){return e.execArgv=process.execArgv,e},wrapTinyPoolResult:function(e){return globalContext.tinyPool=e,e},abortSignal:function(){return globalContext.abortSignal=testRunContext.abortSignal,globalContext.abortSignal},loadGlobalSetupFiles:function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:globalContext.globalSetup=!0,t.label=1;case 1:return t.trys.push([1,,3,4]),[4,e()];case 2:return[2,t.sent()];case 3:return globalContext.globalSetup=!1,[7];case 4:return[2]}})})}},tracer.start(function(){return __awaiter(void 0,void 0,void 0,function(){var e,t,i,r,n,s,o,a,l,c,s,u,o,h,d,p,f,g,v,m,y,_,b,k,T,S,C,L,F,x;return __generator(this,function(j){switch(j.label){case 0:return e=global.$_$session,global.$_$session!==e?[2,[]]:[4,globalContext.runningPromise];case 1:j.sent(),globalContext.abortSignal&&globalContext.abortSignal.emit(),j.label=2;case 2:return j.trys.push([2,4,,5]),[4,initializeVitest()];case 3:return j.sent(),[3,5];case 4:return t=j.sent(),tracer.reportGlobalError("Failed to initialize wallaby vitest.\n"+(t&&t.message||"")+"\n"+(t&&t.stack||"")),[2];case 5:if(j.trys.push([5,11,12,13]),tracer.debugLog("Scheduling Vitest Run ("+e+"): "+(new Date).toISOString()),global.$_$session!==e)return[2,[]];if(globalContext.ctx.vitenode&&globalContext.ctx.vitenode.fetchCache)try{try{for(i=__values(globalContext.ctx.vitenode.fetchCache),r=i.next();!r.done;r=i.next())n=__read(r.value,1),s=n[0],o=getFileData(normalizeModuleId(s)),!o||globalContext.previousTimeStamps[o.path]&&o.ts===globalContext.previousTimeStamps[o.path]||globalContext.ctx.vitenode.fetchCache["delete"](s)}catch(w){b={error:w}}finally{try{r&&!r.done&&(k=i["return"])&&k.call(i)}finally{if(b)throw b.error}}}catch(E){}if(globalContext.ctx.server&&globalContext.ctx.server.moduleGraph&&globalContext.ctx.server.moduleGraph.fileToModulesMap)try{try{for(a=__values(globalContext.ctx.server.moduleGraph.fileToModulesMap),l=a.next();!l.done;l=a.next())if(c=__read(l.value,2),s=c[0],u=c[1],o=getFileData(normalizeModuleId(s)),o&&(!globalContext.previousTimeStamps[o.path]||o.ts!==globalContext.previousTimeStamps[o.path]))try{for(C=void 0,h=__values(u),d=h.next();!d.done;d=h.next())p=d.value,globalContext.ctx.server.moduleGraph.invalidateModule(p)}catch(R){C={error:R}}finally{try{d&&!d.done&&(L=h["return"])&&L.call(h)}finally{if(C)throw C.error}}}catch(I){T={error:I}}finally{try{l&&!l.done&&(S=a["return"])&&S.call(a)}finally{if(T)throw T.error}}}catch(E){}return globalContext.previousTimeStamps={},Object.values(global.$_$tracer._filePathToFileData).forEach(function(e){globalContext.previousTimeStamps[e.path]=e.ts}),e!==global.$_$session?[3,10]:globalContext.ctx.projects?(globalContext.ctx.logger.printBanner=function(){},globalContext.ctx.logger.log=function(){},[4,globalContext.ctx.report("onInit",globalContext.ctx)]):[3,7];case 6:return j.sent(),f=__spreadArray([],__read(globalContext.ctx.projects),!1).sort(function(e,t){return(t.ctx.config.dir||t.ctx.config.root).length-(e.ctx.config.dir||e.ctx.config.root).length}),g=function(e){var t=function(e){return f.find(function(t){var i=t.ctx.config.dir||t.ctx.config.root;return i===e||e.startsWith(i+path.sep)})};return t(e)||globalContext.ctx.projects[0]},globalContext.runningPromise=globalContext.ctx.runFiles(__spreadArray([],__read(testRunContext.testFiles.map(function(e){return[g(e),e]})),!1)),[3,8];case 7:globalContext.runningPromise=globalContext.ctx.runFiles(__spreadArray([],__read(testRunContext.testFiles),!1)),j.label=8;case 8:return[4,globalContext.runningPromise];case 9:j.sent(),j.label=10;case 10:return[3,13];case 11:return v=j.sent(),e===global.$_$session&&(tracer.debugLog("Vitest Error: "+(new Date).toISOString()),v&&console.error(v.stack)),[3,13];case 12:if(globalContext.runningPromise=Promise.resolve(),e===global.$_$session){if(tracer.debugLog("Vitest Run Complete ("+e+"): "+(new Date).toISOString()),globalContext.ctx.state.errorsSet.size>0)try{for(m=__values(globalContext.ctx.state.errorsSet),y=m.next();!y.done;y=m.next())_=y.value,_.message&&0===_.message.indexOf("Error:")&&(_.message=_.message.substring(7)),_.stack&&0===_.stack.indexOf("Error:")&&(_.stack=_.stack.substring(7)),tracer.reportGlobalError(_)}catch(M){F={error:M}}finally{try{y&&!y.done&&(x=m["return"])&&x.call(m)}finally{if(F)throw F.error}}globalContext.ctx.snapshot&&globalContext.ctx.snapshot.summary&&globalContext.ctx.snapshot.summary.uncheckedKeysByFile&&globalContext.ctx.snapshot.summary.uncheckedKeysByFile.forEach(function(e){if(e.keys&&e.keys.length){var t=e.keys.length+" snapshot"+(e.keys.length>1?"s":"")+" obsolete "+("\n\t"+e.keys.join("\n\t")||"");tracer.reportGlobalErrorObject({message:t,stack:t+"\n    at "+e.filePath+":1:0",snapshot:!0,allowNotMappedStackLines:!0})}}),tracer.resetEnvGlobal(),tracer.complete(),testRunContext=void 0}else tracer.debugLog("Vitest Run Abandoned ("+e+"): "+(new Date).toISOString());return[7];case 13:return[2]}})})}),module.exports={init:function(e){var t=[];return testRunContext={testFiles:e,instrumentedFiles:new Map,fetchedModules:new Map,childSessionId:1,abortSignal:{off:function(e,i){return t.push(i)},once:function(){return t.length=0},emit:function(){return t.forEach(function(e){return e()})}}},{configure:function(){throw new Error("Vitest does not support configuration modifications. Please let us know if this is an issue for you at: https:/github.com/wallabyjs/public/issues")}}}};